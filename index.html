<!doctype html>
<html lang="en" dir="ltr">
<head><meta    http-equiv="Content-Security-Policy"    content="default-src 'none'; script-src 'self' 'sha256-zkIfJey2QJSMWsoE/xLvQ6GebR1o8N9s0f9cjTQ7mS0='; style-src 'self'; manifest-src 'self'; img-src data: 'self'; font-src 'self'; prefetch-src 'self'"/>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<title data-react-helmet="true">Pektin</title><meta data-react-helmet="true" property="og:title" content="Pektin"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://pektin-dns.github.io//docs/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/docs/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://pektin-dns.github.io//docs/"><link data-react-helmet="true" rel="alternate" href="https://pektin-dns.github.io//docs/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://pektin-dns.github.io//docs/" hreflang="x-default"><link rel="stylesheet" href="/docs/assets/css/styles.3d6a6acf.css">
<link rel="preload" href="/docs/assets/js/runtime~main.92287373.js" as="script">
<link rel="preload" href="/docs/assets/js/main.e010c5ce.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><img src="/docs/img/logo.svg" alt="Pektin Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/docs/img/logo.svg" alt="Pektin Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Pektin</b></a><a class="navbar__item navbar__link" href="/docs/compose/overview">Compose</a><a class="navbar__item navbar__link" href="/docs/helm/overview">Helm</a><a href="#disabled" class="navbar__item navbar__link">|</a><a class="navbar__item navbar__link" href="/docs/server/overview">Server</a><a class="navbar__item navbar__link" href="/docs/api-server/overview">API</a><a class="navbar__item navbar__link" href="/docs/ui/overview">UI</a><a class="navbar__item navbar__link" href="/docs/certbot/overview">Certbot</a><a class="navbar__item navbar__link" href="/docs/ribston/overview">Ribston</a><a class="navbar__item navbar__link" href="/docs/vault/overview">Vault</a><a class="navbar__item navbar__link" href="/docs/keydb/overview">Keydb</a></div><div class="navbar__items navbar__items--right"><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mdx-wrapper mdx-page"><main class="container container--fluid margin-vert--lg"><div class="row mdxPageWrapper_3qD3"><div class="col col--8"><header><h1>Pektin Documentation</h1></header><br><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="what-is-pektin"></a>What is Pektin?<a class="hash-link" href="#what-is-pektin" title="Direct link to heading">#</a></h2><p>Pektin is a highly opinionated authoritative DNS server with an API, user interface and much more.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="why-use-pektin"></a>Why use Pektin?<a class="hash-link" href="#why-use-pektin" title="Direct link to heading">#</a></h2><ul><li>No more zone files 🙏</li><li>Ultra fast ⚡</li><li>API controllable 🤖</li><li>Memory safe Rust 🦀</li><li>Don&#x27;t rely on one API key that can do everything 🔒</li><li>Easy to use UI with many powerful features 💻</li><li>Support for DOT, DOH and of course plain DNS 📡</li><li>DNSSEC 🔐</li><li>Easy certificate generation 📜</li><li>Fully Open Source 💖</li><li>Scalable 💯</li><li>Privacy first 👁️‍🗨️</li><li>Easy deployment with Docker Compose, Ansible and Helm 🐳🅰️☸️</li><li>Easy use with <a href="https://github.com/mailcow/mailcow-dockerized" target="_blank" rel="noopener noreferrer">mailcow</a> 📬🐮🐳 (Self host all the things!)</li><li>Small image sizes 💾</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="when-not-to-use-pektin"></a>When NOT to use Pektin<a class="hash-link" href="#when-not-to-use-pektin" title="Direct link to heading">#</a></h2><ul><li>It&#x27;s not recommended to use Pektin outside of the provided Docker Compose and/or Helm repos.</li><li>Pektin is not a recursive resolver</li><li>Pektin is not intended to be used with other DNS software like PowerDNS or BIND9</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="what-is-opinionated"></a>What is opinionated?<a class="hash-link" href="#what-is-opinionated" title="Direct link to heading">#</a></h2><p>These things are opinionated although many of them can be expanded on or adjusted manually if needed.
We chose these things to make it easier to provide the features that we needed/wanted.</p><ul><li>No support for every last DNS type (Supported are: AAAA, A, SOA, NS, CAA, CNAME, MX, SRV, TXT, TLSA, OPENPGPKEY) You sure can request an addition to the list of supported types.</li><li>Replication between multiple authoritative servers is done via Keydb not via DNS</li><li>This is NOT a recursive DNS server</li><li>DNSSEC only with method 13 (ECDSA-P256-SHA256)</li><li>DNSSEC is enabled by default</li><li>DNSSEC signing is offloaded to Vault</li><li>Primary focus is deployment to container environments (Docker, Kubernetes etc.)</li><li>Keydb as data store</li><li>Uses Traefik as proxy</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="why-host-your-own-dns-server"></a>Why host your own DNS server?<a class="hash-link" href="#why-host-your-own-dns-server" title="Direct link to heading">#</a></h2><ul><li>Privacy and better compliance with the EU GDPR</li><li>Security</li><li>All domains in one place instead of having them spread out over multiple registrars</li><li>Easy certificate generation</li><li>Coolness 😎</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="how-do-i-get-started"></a>How do I get started?<a class="hash-link" href="#how-do-i-get-started" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="docker-compose"></a><a href="/docs/compose/overview">Docker Compose</a><a class="hash-link" href="#docker-compose" title="Direct link to heading">#</a></h3><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="kubernetes---helm"></a><a href="/docs/helm/overview">Kubernetes - Helm</a><a class="hash-link" href="#kubernetes---helm" title="Direct link to heading">#</a></h3><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="architecture"></a>Architecture<a class="hash-link" href="#architecture" title="Direct link to heading">#</a></h2><p><img alt="Diagram of the Pektin Architecture" src="/docs/assets/images/pektin.drawio-bb7f114891f2b5a3d3cc3093d8e0e899.svg"></p><p>Ohh no so many containers! This must be huge and complicated!<br>
<strong>It is not.</strong></p><p>A core focus was to make it as easy to host your own DNS server as using <a href="https://github.com/mailcow/mailcow-dockerized" target="_blank" rel="noopener noreferrer">mailcow</a> (A project we love for it&#x27;s simplicity and ease of use)</p><p><strong>Image sizes:</strong><br>
API - 3MB<br>
Server - 2MB<br>
UI - 2MB<br>
Ribston - 41MB<br>
Vault - 69MB<br>
Keydb - 10MB</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="server"></a>Server<a class="hash-link" href="#server" title="Direct link to heading">#</a></h3><p>A DNS-Server providing plain DNS, DNS over HTTP and DNS over TLS</p><p>This container is <strong>not</strong> able to sign, nor to do any other authoritative work. <strong>It just delivers records</strong> from <a href="https://keydb.io/" target="_blank" rel="noopener noreferrer">Keydb</a> to the clients.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="keydb"></a><a href="https://keydb.io/" target="_blank" rel="noopener noreferrer">Keydb</a><a class="hash-link" href="#keydb" title="Direct link to heading">#</a></h3><p>Used as fast replicated datastore to keep and distribute the DNS records from the API to the servers.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="api"></a>API<a class="hash-link" href="#api" title="Direct link to heading">#</a></h3><p>Creates the DNS records that are set in <a href="https://github.com/Snapchat/KeyDB" target="_blank" rel="noopener noreferrer">Keydb</a> formated in JSON.</p><p>It can&#x27;t sign records by itself. The signing is offloaded to <a href="https://www.vaultproject.io/" target="_blank" rel="noopener noreferrer">Vault</a> which provides signing as a service keeping your DNS keys as secure as possible.</p><p>A clients request gets checked for validity and then put through the APIs <a href="#ribstonopa-policy-agent">authorization mechanism</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="vault"></a><a href="https://www.vaultproject.io/" target="_blank" rel="noopener noreferrer">Vault</a><a class="hash-link" href="#vault" title="Direct link to heading">#</a></h3><p>Used for signing the DNS records with its <a href="https://www.vaultproject.io/api-docs/secret/transit" target="_blank" rel="noopener noreferrer">transit engine</a> as well as for keeping the Pektin configuration, registrar API keys and other secrets needed for the Pektin APIs <a href="#ribstonopa-policy-agent">authorization mechanism</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ui"></a>UI<a class="hash-link" href="#ui" title="Direct link to heading">#</a></h3><p>Standalone web-UI without any dynamic backend to have easy control over the multi container system.</p><p>A React app served by our own simple high performance static web server <a href="https://github.com/pektin-dns/feoco" target="_blank" rel="noopener noreferrer">feoco</a> (<strong>609KB</strong>).
We dropped nginx because of its less than optimal configuration possibilities.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="trinitrotoluol-tnt"></a>Trinitrotoluol (TNT)<a class="hash-link" href="#trinitrotoluol-tnt" title="Direct link to heading">#</a></h3><p>TNT is just an addition for UI to perform DOH queries and not meant for publicly serving DNS records.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="ribstonopa-policy-agent"></a>Ribston/OPA (Policy Agent)<a class="hash-link" href="#ribstonopa-policy-agent" title="Direct link to heading">#</a></h3><p>As we don&#x27;t want to have a single API token for everything like other DNS Servers or registrars, we need a way to check if a client is authorized to perform a request. The most common way to achieve this are ACLs or similar mechanisms that are all fast to evaluate but not very fine grained. We decided to use the <strong>most fine grained</strong> and <strong>flexible</strong> mechanism we have available: <strong>Programming</strong></p><p>With programmable policies we are able to only allow a client to have access to a specific subdomain and RRType. The preconfigured acme client for example is only allowed to access the <code>_acme-challenge</code> subdomain and the <code>TXT</code> RRType.</p><p>You can do anything you never wanted like only allowing access at a specific time of day or more useful things like restricting the clients access to a specific IP address.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="open-policy-agent"></a><a href="https://www.openpolicyagent.org/" target="_blank" rel="noopener noreferrer">Open Policy Agent</a><a class="hash-link" href="#open-policy-agent" title="Direct link to heading">#</a></h4><p>We tried using OPA for this purpose, but found that it is not exactly what we needed for our use case and also difficult to write a complex policy for. OPA is planed to be usable with the API but only if someone other than us gets arround to write the standard policies for it.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="ribston"></a>Ribston<a class="hash-link" href="#ribston" title="Direct link to heading">#</a></h4><p>We liked the concept of programmable policies though, so we created our own policy agent.</p><p>The policies are written in TypeScript/JavaScript and are evaluated using the Deno JavaScript runtime spawning workers and/or subprocesses to evaluate the given policies.</p><p>This enables you to write your own policies without a degree in Rego (OPAs policy language) and to use all established devtools for JS/TS.</p><p>The evaluation is nearly as fast as using OPA but the IPC overhead is slowing it down a lot.
Evaluation takes about 0.1ms but IPC overhead is about 4-8ms.</p><p>Policies are evaluated in parallel.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="traefik"></a><a href="https://traefik.io/traefik/" target="_blank" rel="noopener noreferrer">Traefik</a><a class="hash-link" href="#traefik" title="Direct link to heading">#</a></h3><p>We are using traefik for multiple purposes:</p><ul><li>TLS termination</li><li>Proxy requests to internal service endpoints</li><li>Proxy requests to external services and adding CORS headers</li><li>Creating certificates for pektin itself</li><li><strong>DNS over TLS</strong> from <strong>plain DNS</strong> coming from the server</li><li><strong>DNS over HTTPS</strong> from <strong>DNS over HTTP</strong> coming from the server</li></ul></div><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-is-pektin" class="table-of-contents__link">What is Pektin?</a></li><li><a href="#why-use-pektin" class="table-of-contents__link">Why use Pektin?</a></li><li><a href="#when-not-to-use-pektin" class="table-of-contents__link">When NOT to use Pektin</a></li><li><a href="#what-is-opinionated" class="table-of-contents__link">What is opinionated?</a></li><li><a href="#why-host-your-own-dns-server" class="table-of-contents__link">Why host your own DNS server?</a></li><li><a href="#how-do-i-get-started" class="table-of-contents__link">How do I get started?</a><ul><li><a href="#docker-compose" class="table-of-contents__link">Docker Compose</a></li><li><a href="#kubernetes---helm" class="table-of-contents__link">Kubernetes - Helm</a></li></ul></li><li><a href="#architecture" class="table-of-contents__link">Architecture</a><ul><li><a href="#server" class="table-of-contents__link">Server</a></li><li><a href="#keydb" class="table-of-contents__link">Keydb</a></li><li><a href="#api" class="table-of-contents__link">API</a></li><li><a href="#vault" class="table-of-contents__link">Vault</a></li><li><a href="#ui" class="table-of-contents__link">UI</a></li><li><a href="#trinitrotoluol-tnt" class="table-of-contents__link">Trinitrotoluol (TNT)</a></li><li><a href="#ribstonopa-policy-agent" class="table-of-contents__link">Ribston/OPA (Policy Agent)</a></li><li><a href="#traefik" class="table-of-contents__link">Traefik</a></li></ul></li></ul></div></div></div></main></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Repos</div><ul class="footer__items"><li class="footer__item"><a href="https://git.y.gy/pektin" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>git.y.gy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://gitlab.com/pektin" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/pektin-dns" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a href="https://pektin.gitlab.io/docs/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitLab<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://pektin-dns.github.io/docs/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Container Images</div><ul class="footer__items"><li class="footer__item"><a href="https://hub.docker.com/repositories" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Docker Hub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2022 Paul, Max and the Pektin Contributors.</div></div></div></footer></div>
<script src="/docs/assets/js/runtime~main.92287373.js"></script>
<script src="/docs/assets/js/main.e010c5ce.js"></script>
</body>
</html>